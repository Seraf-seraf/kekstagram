import{userImagePreviewContainer,body,uploadForm,scalePhotoBar,getSizePhoto}from"./user-image-window.min.js";import{sliderFilter,onClickFilter,resetFilters}from"./filter-slider.min.js";import{isEscapeKey}from"./util.min.js";import{setData}from"./backend.min.js";const closeWindowUserImage=()=>{document.removeEventListener("keydown",onEscKeydown),body.classList.remove("modal-open"),userImagePreviewContainer.classList.add("hidden"),uploadForm.reset(),scalePhotoBar.removeEventListener("click",getSizePhoto),sliderFilter.removeEventListener("change",onClickFilter),resetFilters()},onCloseButton=()=>{closeWindowUserImage()};function onEscKeydown(e){const t=e.target;t.matches(".text__description")||t.matches(".text__hashtags")?e.stopPropagation():isEscapeKey(e)&&closeWindowUserImage()}const form=document.querySelector(".img-upload__form"),pristine=new Pristine(form,{classTo:"img-upload__text",errorTextParent:"img-upload__text",errorTextClass:"form--error"},!0),hashtags=form.querySelector(".text__hashtags"),hashtagTemplate=/^#[A-Za-zА-Яа-яЁё0-9]{1,19}$/;function hashtagValidation(){const e=hashtags.value.toLowerCase().trim().split(" ").filter(Boolean);return!(e.length>5)&&e.every((t=>{if(hashtagTemplate.test(t)&&t.length<=20){return!(e.filter(((e,o,s)=>e===t&&o!==s.indexOf(e))).length>0)}return!1}))}pristine.addValidator(hashtags,hashtagValidation,"Хэштеги заполнены неверно");const addLoader=()=>{document.querySelector(".img-upload__message").classList.toggle("hidden")},submitButton=document.querySelector(".img-upload__submit"),blockSubmitButton=()=>{submitButton.disabled=!0,submitButton.textContent="Сохраняю..."},unblockSubmitButton=()=>{submitButton.disabled=!1,submitButton.textContent="Опубликовать"},setUserImageSubmit=e=>{form.addEventListener("submit",(t=>{t.preventDefault();const o=new FormData(t.target);pristine.validate()&&(submitButton.disabled=!0,submitButton.textContent="Сохраняю...",setData(e,unblockSubmitButton,addLoader,o))}))};export{onCloseButton,onEscKeydown,setUserImageSubmit,closeWindowUserImage};